{% extends "base.html" %}

{% block title %}–†–µ–∑—É–ª—å—Ç–∞—Ç—ã ‚Äî {{ session.title }}{% endblock %}

{% block content %}
<div class="form-box">
    <h2>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã: {{ session.title }}</h2>

    {% if session.description %}
        <p class="session-desc">{{ session.description }}</p>
    {% endif %}

    <div class="results-info">
        <span>–í—Å–µ–≥–æ –≥–æ–ª–æ—Å–æ–≤: {{ total_votes }}</span>
        <span>–ë–ª–æ–∫–æ–≤ –≤ —Ü–µ–ø–∏: {{ block_count }}</span>
        <span>–°—Ç–∞—Ç—É—Å:
            {% if is_valid %}
                <span class="status-valid">‚úÖ –¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞</span>
            {% else %}
                <span class="status-invalid">‚ùå –ù–∞—Ä—É—à–µ–Ω–∏–µ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏!</span>
            {% endif %}
        </span>
    </div>

    {% if results %}
    <div class="chart-container">
        {% for result in results %}
        <div class="chart-bar">
            <div class="bar-label">
                <span class="candidate-name">{{ result.name }}</span>
                <span class="vote-count">{{ result.votes }} ({{ "%.1f"|format(result.percent) }}%)</span>
            </div>
            <div class="bar-outer">
                <div class="bar-inner" style="width: {{ result.percent }}%;"></div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p>–ù–µ—Ç –≥–æ–ª–æ—Å–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.</p>
    {% endif %}

    <div class="blockchain-info">
        <h3>üîí –ê—É–¥–∏—Ç –±–ª–æ–∫—á–µ–π–Ω–∞</h3>
        <p>–õ—é–±–æ–π –º–æ–∂–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Å—Ç–Ω–æ—Å—Ç—å –ø–æ–¥—Å—á–µ—Ç–∞. –ö–∞–∂–¥—ã–π –≥–æ–ª–æ—Å –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω –≤ –±–ª–æ–∫—á–µ–π–Ω–µ –∏ –∑–∞—â–∏—â—ë–Ω –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏–µ–π.</p>
        <button id="toggleJournal" class="btn-outline" data-session-id="{{ session.id }}">–ü–æ–∫–∞–∑–∞—Ç—å –∂—É—Ä–Ω–∞–ª –≥–æ–ª–æ—Å–æ–≤</button>
        <button onclick="downloadPDF('{{ session.id }}')" class="btn-outline">–°–∫–∞—á–∞—Ç—å PDF-–æ—Ç—á—ë—Ç</button>

        <div id="journalContainer" style="display: none; margin-top: 20px;">
            <h4>–ñ—É—Ä–Ω–∞–ª –≥–æ–ª–æ—Å–æ–≤ ({{ total_votes }} –∑–∞–ø–∏—Å–µ–π):</h4>
            <div id="journalContent"></div>
        </div>
    </div>

    <a href="{{ url_for('index') }}" class="back-link">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é</a>
</div>

<script>
function downloadPDF(sessionId) {
    window.location.href = `/api/results/${sessionId}/pdf`;
}
</script>
{% endblock %}